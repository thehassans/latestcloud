import{h as e,l as s,d as a,j as t,H as r,t as i,z as l}from"./index-CU5Tossx.js";import{i as d,r as n,L as c}from"./vendor-DCxmN9Fm.js";import{u as m}from"./useMutation-TGuMXCMR.js";import{c as x}from"./charts-BQAPh6PV.js";import{aq as o,d as u}from"./ui-Zr-QG1cz.js";function p(){const{uuid:p}=d(),{user:h}=e(),j=s(),[f,b]=n.useState(""),{data:y,isLoading:N}=a({queryKey:["ticket",p],queryFn:()=>i.getOne(p).then(e=>e.data)}),k=m({mutationFn:e=>i.reply(p,e),onSuccess:()=>{j.invalidateQueries(["ticket",p]),b(""),l.success("Reply sent!")}});if(N)return t.jsx("div",{className:"text-center py-12",children:"Loading..."});if(!(null==y?void 0:y.ticket))return t.jsx("div",{className:"text-center py-12",children:"Ticket not found"});const v=y.ticket,g=y.replies||[];return t.jsxs(t.Fragment,{children:[t.jsx(r,{children:t.jsxs("title",{children:["Ticket #",v.ticket_number," - Magnetic Clouds"]})}),t.jsxs(c,{to:"/dashboard/tickets",className:"inline-flex items-center gap-2 text-dark-500 hover:text-primary-500 mb-6",children:[t.jsx(o,{className:"w-4 h-4"})," Back to Tickets"]}),t.jsxs("div",{className:"max-w-3xl",children:[t.jsx("div",{className:"card p-6 mb-6",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold",children:v.subject}),t.jsxs("p",{className:"text-dark-500 text-sm",children:["#",v.ticket_number," â€¢ ",v.department]})]}),t.jsx("span",{className:x("badge","closed"===v.status?"bg-dark-100 text-dark-500":"badge-primary"),children:v.status})]})}),t.jsx("div",{className:"space-y-4 mb-6",children:g.map(e=>{var s,a;return t.jsxs("div",{className:x("card p-4",e.is_staff_reply&&"border-l-4 border-primary-500"),children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsxs("div",{className:x("w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold",e.is_staff_reply?"bg-primary-500":"bg-dark-400"),children:[null==(s=e.first_name)?void 0:s[0],null==(a=e.last_name)?void 0:a[0]]}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:[e.first_name," ",e.last_name]}),t.jsx("p",{className:"text-xs text-dark-500",children:new Date(e.created_at).toLocaleString()})]})]}),t.jsx("p",{className:"text-dark-700 dark:text-dark-300 whitespace-pre-wrap",children:e.message})]},e.id)})}),"closed"!==v.status&&t.jsxs("div",{className:"card p-6",children:[t.jsx("h3",{className:"font-bold mb-4",children:"Reply"}),t.jsx("textarea",{value:f,onChange:e=>b(e.target.value),className:"input min-h-[120px] mb-4",placeholder:"Type your reply..."}),t.jsxs("button",{onClick:()=>k.mutate(f),disabled:!f.trim()||k.isPending,className:"btn-primary",children:[t.jsx(u,{className:"w-4 h-4 mr-2"})," Send Reply"]})]})]})]})}export{p as default};
