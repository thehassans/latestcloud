import{a as e,l as s,d as a,j as t,H as d,z as r,x as l}from"./index-x2d3c5-i.js";import{r as n}from"./vendor-DCxmN9Fm.js";import{u as i}from"./useMutation-CCXmgn5Z.js";import{c}from"./charts-BQAPh6PV.js";import{a4 as m,O as o,a0 as u,X as x,at as h,au as p,o as j}from"./ui-DCv-FT-z.js";const g={pending:"badge-warning",processing:"badge-primary",active:"badge-success",completed:"badge-success",cancelled:"badge-danger"},f={pending:"badge-warning",paid:"badge-success",failed:"badge-danger",refunded:"badge-primary"};function N(){var N;const{format:b}=e(),v=s(),[k,y]=n.useState(null),[w,_]=n.useState(null),{data:C,isLoading:O}=a({queryKey:["admin-orders"],queryFn:()=>l.getOrders().then(e=>e.data)}),P=i({mutationFn:({uuid:e,status:s,payment_status:a})=>l.updateOrderStatus(e,{status:s,payment_status:a}),onSuccess:()=>{v.invalidateQueries(["admin-orders"]),r.success("Order updated successfully"),y(null)},onError:()=>r.error("Failed to update order")});return t.jsxs(t.Fragment,{children:[t.jsx(d,{children:t.jsx("title",{children:"Orders - Admin - Magnetic Clouds"})}),t.jsx("h1",{className:"text-2xl font-bold mb-8",children:"Orders Management"}),O?t.jsx("div",{className:"text-center py-12",children:"Loading..."}):t.jsxs("div",{className:"card overflow-hidden",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-dark-50 dark:bg-dark-800",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left p-4 font-medium",children:"Order #"}),t.jsx("th",{className:"text-left p-4 font-medium",children:"Customer"}),t.jsx("th",{className:"text-left p-4 font-medium",children:"Total"}),t.jsx("th",{className:"text-left p-4 font-medium",children:"Method"}),t.jsx("th",{className:"text-left p-4 font-medium",children:"Payment"}),t.jsx("th",{className:"text-left p-4 font-medium",children:"Status"}),t.jsx("th",{className:"text-left p-4 font-medium",children:"Date"}),t.jsx("th",{className:"text-right p-4 font-medium",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-dark-100 dark:divide-dark-700",children:null==(N=null==C?void 0:C.orders)?void 0:N.map(e=>{const s="bank"===(a=e.payment_method)?h:"cash"===a?p:j;var a;return t.jsxs("tr",{className:"hover:bg-dark-50 dark:hover:bg-dark-800/50",children:[t.jsx("td",{className:"p-4 font-medium",children:e.order_number}),t.jsxs("td",{className:"p-4",children:[t.jsxs("div",{children:[e.first_name," ",e.last_name]}),t.jsx("div",{className:"text-sm text-dark-500",children:e.email})]}),t.jsx("td",{className:"p-4 font-bold",children:b(e.total)}),t.jsx("td",{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(s,{className:"w-4 h-4"}),t.jsx("span",{className:"capitalize",children:e.payment_method})]})}),t.jsx("td",{className:"p-4",children:t.jsx("span",{className:c("badge",f[e.payment_status]),children:e.payment_status})}),t.jsx("td",{className:"p-4",children:t.jsx("span",{className:c("badge",g[e.status]),children:e.status})}),t.jsxs("td",{className:"p-4 text-dark-500",children:[t.jsx("div",{children:new Date(e.created_at).toLocaleDateString()}),t.jsx("div",{className:"text-xs",children:new Date(e.created_at).toLocaleTimeString()})]}),t.jsx("td",{className:"p-4 text-right",children:t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.payment_proof&&t.jsx("button",{onClick:()=>_(e.payment_proof),className:"p-2 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded-lg text-blue-500",title:"View Payment Proof",children:t.jsx(m,{className:"w-4 h-4"})}),"pending"===e.payment_status&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>(e=>{P.mutate({uuid:e.uuid,status:"active",payment_status:"paid"})})(e),className:"p-2 hover:bg-green-100 dark:hover:bg-green-900/20 rounded-lg text-green-500",title:"Approve Payment",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>(e=>{P.mutate({uuid:e.uuid,status:"cancelled",payment_status:"failed"})})(e),className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg text-red-500",title:"Reject Order",children:t.jsx(u,{className:"w-4 h-4"})})]})]})})]},e.uuid)})})]})}),(!(null==C?void 0:C.orders)||0===C.orders.length)&&t.jsx("div",{className:"p-12 text-center text-dark-500",children:"No orders found"})]}),w&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>_(null),children:t.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl max-w-2xl max-h-[90vh] overflow-auto p-6",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-bold",children:"Payment Proof"}),t.jsx("button",{onClick:()=>_(null),className:"p-2 hover:bg-dark-100 dark:hover:bg-dark-700 rounded-lg",children:t.jsx(x,{className:"w-5 h-5"})})]}),t.jsx("img",{src:w,alt:"Payment proof",className:"max-w-full rounded-lg"})]})})]})}export{N as default};
