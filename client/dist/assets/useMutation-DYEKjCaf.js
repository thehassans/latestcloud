var t,s,e,i,a,r,n,o,h=t=>{throw TypeError(t)},l=(t,s,e)=>s.has(t)||h("Cannot "+e),u=(t,s,e)=>(l(t,s,"read from private field"),e?e.call(t):s.get(t)),c=(t,s,e)=>s.has(t)?h("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,e),d=(t,s,e,i)=>(l(t,s,"write to private field"),i?i.call(t,e):s.set(t,e),e),p=(t,s,e)=>(l(t,s,"access private method"),e);import{r as m}from"./vendor-DCxmN9Fm.js";import{S as v,i as b,D as f,E as y,y as O,B as w,n as C,A as M}from"./index-BvZn07uu.js";var S=(o=class extends v{constructor(n,o){super(),c(this,a),c(this,t),c(this,s),c(this,e),c(this,i),d(this,t,n),this.setOptions(o),this.bindMethods(),p(this,a,r).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var i;const a=this.options;this.options=u(this,t).defaultMutationOptions(s),b(this.options,a)||u(this,t).getMutationCache().notify({type:"observerOptionsUpdated",mutation:u(this,e),observer:this}),(null==a?void 0:a.mutationKey)&&this.options.mutationKey&&f(a.mutationKey)!==f(this.options.mutationKey)?this.reset():"pending"===(null==(i=u(this,e))?void 0:i.state.status)&&u(this,e).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||null==(t=u(this,e))||t.removeObserver(this)}onMutationUpdate(t){p(this,a,r).call(this),p(this,a,n).call(this,t)}getCurrentResult(){return u(this,s)}reset(){var t;null==(t=u(this,e))||t.removeObserver(this),d(this,e,void 0),p(this,a,r).call(this),p(this,a,n).call(this)}mutate(s,a){var r;return d(this,i,a),null==(r=u(this,e))||r.removeObserver(this),d(this,e,u(this,t).getMutationCache().build(u(this,t),this.options)),u(this,e).addObserver(this),u(this,e).execute(s)}},t=new WeakMap,s=new WeakMap,e=new WeakMap,i=new WeakMap,a=new WeakSet,r=function(){var t;const i=(null==(t=u(this,e))?void 0:t.state)??y();d(this,s,{...i,isPending:"pending"===i.status,isSuccess:"success"===i.status,isError:"error"===i.status,isIdle:"idle"===i.status,mutate:this.mutate,reset:this.reset})},n=function(e){O.batch(()=>{var a,r,n,o,h,l,c,d;if(u(this,i)&&this.hasListeners()){const p=u(this,s).variables,m=u(this,s).context,v={client:u(this,t),meta:this.options.meta,mutationKey:this.options.mutationKey};"success"===(null==e?void 0:e.type)?(null==(r=(a=u(this,i)).onSuccess)||r.call(a,e.data,p,m,v),null==(o=(n=u(this,i)).onSettled)||o.call(n,e.data,null,p,m,v)):"error"===(null==e?void 0:e.type)&&(null==(l=(h=u(this,i)).onError)||l.call(h,e.error,p,m,v),null==(d=(c=u(this,i)).onSettled)||d.call(c,void 0,e.error,p,m,v))}this.listeners.forEach(t=>{t(u(this,s))})})},o);function g(t,s){const e=w(),[i]=m.useState(()=>new S(e,t));m.useEffect(()=>{i.setOptions(t)},[i,t]);const a=m.useSyncExternalStore(m.useCallback(t=>i.subscribe(O.batchCalls(t)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),r=m.useCallback((t,s)=>{i.mutate(t,s).catch(C)},[i]);if(a.error&&M(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:r,mutateAsync:a.mutate}}export{g as u};
