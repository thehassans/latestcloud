import{a as e,C as s,j as a,H as t,z as d,G as r}from"./index-CQVO-mQk.js";import{r as l}from"./vendor-DCxmN9Fm.js";import{u as n}from"./useQuery-WIrmssiq.js";import{u as i}from"./useMutation-BDwMD8FO.js";import{c}from"./charts-BQAPh6PV.js";import{a3 as m,Q as o,$ as u,X as x,ao as h,ap as p,o as j}from"./ui-m_YuDHVB.js";const g={pending:"badge-warning",processing:"badge-primary",active:"badge-success",completed:"badge-success",cancelled:"badge-danger"},f={pending:"badge-warning",paid:"badge-success",failed:"badge-danger",refunded:"badge-primary"};function N(){var N;const{format:b}=e(),v=s(),[k,y]=l.useState(null),[w,_]=l.useState(null),{data:C,isLoading:P}=n({queryKey:["admin-orders"],queryFn:()=>r.getOrders().then(e=>e.data)}),O=i({mutationFn:({uuid:e,status:s,payment_status:a})=>r.updateOrderStatus(e,{status:s,payment_status:a}),onSuccess:()=>{v.invalidateQueries(["admin-orders"]),d.success("Order updated successfully"),y(null)},onError:()=>d.error("Failed to update order")});return a.jsxs(a.Fragment,{children:[a.jsx(t,{children:a.jsx("title",{children:"Orders - Admin - Magnetic Clouds"})}),a.jsx("h1",{className:"text-2xl font-bold mb-8",children:"Orders Management"}),P?a.jsx("div",{className:"text-center py-12",children:"Loading..."}):a.jsxs("div",{className:"card overflow-hidden",children:[a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-dark-50 dark:bg-dark-800",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left p-4 font-medium",children:"Order #"}),a.jsx("th",{className:"text-left p-4 font-medium",children:"Customer"}),a.jsx("th",{className:"text-left p-4 font-medium",children:"Total"}),a.jsx("th",{className:"text-left p-4 font-medium",children:"Method"}),a.jsx("th",{className:"text-left p-4 font-medium",children:"Payment"}),a.jsx("th",{className:"text-left p-4 font-medium",children:"Status"}),a.jsx("th",{className:"text-left p-4 font-medium",children:"Date"}),a.jsx("th",{className:"text-right p-4 font-medium",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-dark-100 dark:divide-dark-700",children:null==(N=null==C?void 0:C.orders)?void 0:N.map(e=>{const s="bank"===(t=e.payment_method)?h:"cash"===t?p:j;var t;return a.jsxs("tr",{className:"hover:bg-dark-50 dark:hover:bg-dark-800/50",children:[a.jsx("td",{className:"p-4 font-medium",children:e.order_number}),a.jsxs("td",{className:"p-4",children:[a.jsxs("div",{children:[e.first_name," ",e.last_name]}),a.jsx("div",{className:"text-sm text-dark-500",children:e.email})]}),a.jsx("td",{className:"p-4 font-bold",children:b(e.total)}),a.jsx("td",{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(s,{className:"w-4 h-4"}),a.jsx("span",{className:"capitalize",children:e.payment_method})]})}),a.jsx("td",{className:"p-4",children:a.jsx("span",{className:c("badge",f[e.payment_status]),children:e.payment_status})}),a.jsx("td",{className:"p-4",children:a.jsx("span",{className:c("badge",g[e.status]),children:e.status})}),a.jsxs("td",{className:"p-4 text-dark-500",children:[a.jsx("div",{children:new Date(e.created_at).toLocaleDateString()}),a.jsx("div",{className:"text-xs",children:new Date(e.created_at).toLocaleTimeString()})]}),a.jsx("td",{className:"p-4 text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.payment_proof&&a.jsx("button",{onClick:()=>_(e.payment_proof),className:"p-2 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded-lg text-blue-500",title:"View Payment Proof",children:a.jsx(m,{className:"w-4 h-4"})}),"pending"===e.payment_status&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>(e=>{O.mutate({uuid:e.uuid,status:"active",payment_status:"paid"})})(e),className:"p-2 hover:bg-green-100 dark:hover:bg-green-900/20 rounded-lg text-green-500",title:"Approve Payment",children:a.jsx(o,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(e=>{O.mutate({uuid:e.uuid,status:"cancelled",payment_status:"failed"})})(e),className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg text-red-500",title:"Reject Order",children:a.jsx(u,{className:"w-4 h-4"})})]})]})})]},e.uuid)})})]})}),(!(null==C?void 0:C.orders)||0===C.orders.length)&&a.jsx("div",{className:"p-12 text-center text-dark-500",children:"No orders found"})]}),w&&a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>_(null),children:a.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl max-w-2xl max-h-[90vh] overflow-auto p-6",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-lg font-bold",children:"Payment Proof"}),a.jsx("button",{onClick:()=>_(null),className:"p-2 hover:bg-dark-100 dark:hover:bg-dark-700 rounded-lg",children:a.jsx(x,{className:"w-5 h-5"})})]}),a.jsx("img",{src:w,alt:"Payment proof",className:"max-w-full rounded-lg"})]})})]})}export{N as default};
