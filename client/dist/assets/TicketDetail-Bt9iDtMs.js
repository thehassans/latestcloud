import{f as e,C as s,j as a,H as t,D as r,z as i}from"./index-CKEzCutT.js";import{i as l,r as n,L as c}from"./vendor-DCxmN9Fm.js";import{u as d}from"./useQuery-C0PlQoh3.js";import{u as m}from"./useMutation-DatopEqx.js";import{c as x}from"./charts-BQAPh6PV.js";import{al as o,d as u}from"./ui-m_YuDHVB.js";function p(){const{uuid:p}=l(),{user:h}=e(),j=s(),[f,b]=n.useState(""),{data:y,isLoading:N}=d({queryKey:["ticket",p],queryFn:()=>r.getOne(p).then(e=>e.data)}),k=m({mutationFn:e=>r.reply(p,e),onSuccess:()=>{j.invalidateQueries(["ticket",p]),b(""),i.success("Reply sent!")}});if(N)return a.jsx("div",{className:"text-center py-12",children:"Loading..."});if(!(null==y?void 0:y.ticket))return a.jsx("div",{className:"text-center py-12",children:"Ticket not found"});const v=y.ticket,g=y.replies||[];return a.jsxs(a.Fragment,{children:[a.jsx(t,{children:a.jsxs("title",{children:["Ticket #",v.ticket_number," - Magnetic Clouds"]})}),a.jsxs(c,{to:"/dashboard/tickets",className:"inline-flex items-center gap-2 text-dark-500 hover:text-primary-500 mb-6",children:[a.jsx(o,{className:"w-4 h-4"})," Back to Tickets"]}),a.jsxs("div",{className:"max-w-3xl",children:[a.jsx("div",{className:"card p-6 mb-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold",children:v.subject}),a.jsxs("p",{className:"text-dark-500 text-sm",children:["#",v.ticket_number," â€¢ ",v.department]})]}),a.jsx("span",{className:x("badge","closed"===v.status?"bg-dark-100 text-dark-500":"badge-primary"),children:v.status})]})}),a.jsx("div",{className:"space-y-4 mb-6",children:g.map(e=>{var s,t;return a.jsxs("div",{className:x("card p-4",e.is_staff_reply&&"border-l-4 border-primary-500"),children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsxs("div",{className:x("w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold",e.is_staff_reply?"bg-primary-500":"bg-dark-400"),children:[null==(s=e.first_name)?void 0:s[0],null==(t=e.last_name)?void 0:t[0]]}),a.jsxs("div",{children:[a.jsxs("p",{className:"font-medium",children:[e.first_name," ",e.last_name]}),a.jsx("p",{className:"text-xs text-dark-500",children:new Date(e.created_at).toLocaleString()})]})]}),a.jsx("p",{className:"text-dark-700 dark:text-dark-300 whitespace-pre-wrap",children:e.message})]},e.id)})}),"closed"!==v.status&&a.jsxs("div",{className:"card p-6",children:[a.jsx("h3",{className:"font-bold mb-4",children:"Reply"}),a.jsx("textarea",{value:f,onChange:e=>b(e.target.value),className:"input min-h-[120px] mb-4",placeholder:"Type your reply..."}),a.jsxs("button",{onClick:()=>k.mutate(f),disabled:!f.trim()||k.isPending,className:"btn-primary",children:[a.jsx(u,{className:"w-4 h-4 mr-2"})," Send Reply"]})]})]})]})}export{p as default};
