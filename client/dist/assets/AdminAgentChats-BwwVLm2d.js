import{y as e,j as s,H as a,z as t}from"./index-diqVmdK8.js";import{r as l}from"./vendor-DCxmN9Fm.js";import{c as r}from"./charts-BQAPh6PV.js";import{r as i,ag as n,am as d,y as c,az as o,m as x,q as m,aA as h,N as u,a3 as g,A as p,X as j,w as v}from"./ui-m_YuDHVB.js";function N(){var N,b,f;const{savedChats:w,deleteChat:k,clearAllChats:y}=e(),[C,S]=l.useState(""),[A,L]=l.useState("all"),[D,I]=l.useState(null),[T,U]=l.useState(!1),O=l.useMemo(()=>w.filter(e=>{var s,a,t,l;if("all"!==A&&e.status!==A)return!1;if(C){const r=C.toLowerCase(),i=null==(s=e.chatId)?void 0:s.toLowerCase().includes(r),n=null==(t=null==(a=e.agent)?void 0:a.name)?void 0:t.toLowerCase().includes(r),d=null==(l=e.messages)?void 0:l.some(e=>{var s;return null==(s=e.content)?void 0:s.toLowerCase().includes(r)});return i||n||d}return!0}),[w,C,A]),z=e=>{navigator.clipboard.writeText(e),t.success("Chat ID copied!")},R=e=>{if(!e)return"N/A";const s=new Date(e);return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return s.jsxs(s.Fragment,{children:[s.jsx(a,{children:s.jsx("title",{children:"Chat History - Admin - Magnetic Clouds"})}),s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[s.jsx(i,{className:"w-8 h-8 text-indigo-500"}),"Chat History"]}),s.jsxs("p",{className:"text-dark-500 mt-1",children:[w.length," total conversations"]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:()=>{const e=JSON.stringify(w,null,2),s=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download=`chat-history-${(new Date).toISOString().split("T")[0]}.json`,l.click(),URL.revokeObjectURL(a),t.success("Chat history exported!")},disabled:0===w.length,className:"btn-outline flex items-center gap-2",children:[s.jsx(n,{className:"w-4 h-4"}),"Export JSON"]}),s.jsxs("button",{onClick:()=>U(!0),disabled:0===w.length,className:"btn-outline text-red-500 border-red-200 hover:bg-red-50 dark:border-red-800 dark:hover:bg-red-900/20 flex items-center gap-2",children:[s.jsx(d,{className:"w-4 h-4"}),"Delete All"]})]})]}),s.jsx("div",{className:"card p-4 mb-6",children:s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(c,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-400"}),s.jsx("input",{type:"text",value:C,onChange:e=>S(e.target.value),placeholder:"Search by chat ID, agent name, or message...",className:"input pl-10 w-full"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(o,{className:"w-5 h-5 text-dark-400"}),s.jsxs("select",{value:A,onChange:e=>L(e.target.value),className:"input",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"closed_by_user",children:"Closed by User"})]})]})]})}),0===O.length?s.jsxs("div",{className:"card p-12 text-center",children:[s.jsx(i,{className:"w-16 h-16 text-dark-300 mx-auto mb-4"}),s.jsx("p",{className:"text-dark-500 font-medium",children:"No chats found"}),s.jsx("p",{className:"text-dark-400 text-sm mt-1",children:0===w.length?"Chat history will appear here when customers start conversations":"Try adjusting your search or filter criteria"})]}):s.jsx("div",{className:"space-y-4",children:O.map(e=>{var a,l,n,c,o;return s.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"card p-4 hover:shadow-lg transition-shadow",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[(null==(a=e.agent)?void 0:a.avatar)?s.jsx("img",{src:e.agent.avatar,alt:e.agent.name,className:"w-12 h-12 rounded-full border-2 border-indigo-200 dark:border-indigo-800"}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-dark-200 dark:bg-dark-700 flex items-center justify-center",children:s.jsx(m,{className:"w-6 h-6 text-dark-400"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx("p",{className:"font-semibold",children:(null==(l=e.agent)?void 0:l.name)||"Unknown Agent"}),s.jsx("span",{className:r("px-2 py-0.5 text-xs rounded-full font-medium","completed"===e.status?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"),children:"completed"===e.status?"Completed":"Closed by User"})]}),s.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-dark-500",children:[s.jsxs("button",{onClick:()=>z(e.chatId),className:"flex items-center gap-1 hover:text-indigo-500 transition-colors",children:[s.jsx(h,{className:"w-3 h-3"}),e.chatId]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(u,{className:"w-3 h-3"}),R(e.startedAt)]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(i,{className:"w-3 h-3"}),(null==(n=e.messages)?void 0:n.length)||0," messages"]})]}),e.messages&&e.messages.length>0&&s.jsxs("p",{className:"text-sm text-dark-400 mt-2 truncate max-w-lg",children:["Last: ",null==(o=null==(c=e.messages[e.messages.length-1])?void 0:c.content)?void 0:o.substring(0,60),"..."]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>I(e),className:"p-2 hover:bg-dark-100 dark:hover:bg-dark-700 rounded-lg transition-colors",title:"View Details",children:s.jsx(g,{className:"w-5 h-5 text-dark-500"})}),s.jsx("button",{onClick:()=>{return s=e.chatId,k(s),void t.success("Chat deleted");var s},className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-500",title:"Delete",children:s.jsx(d,{className:"w-5 h-5"})})]})]})},e.chatId)})}),s.jsx(p,{children:D&&s.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>I(null),children:s.jsxs(x.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-dark-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[(null==(N=D.agent)?void 0:N.avatar)&&s.jsx("img",{src:D.agent.avatar,alt:D.agent.name,className:"w-14 h-14 rounded-full border-3 border-white/30"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-bold",children:null==(b=D.agent)?void 0:b.name}),s.jsx("div",{className:"flex items-center gap-3 mt-1 text-sm text-white/70",children:s.jsxs("button",{onClick:()=>z(D.chatId),className:"flex items-center gap-1 hover:text-white transition-colors",children:[s.jsx(h,{className:"w-3 h-3"}),D.chatId]})})]})]}),s.jsx("button",{onClick:()=>I(null),className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:s.jsx(j,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"flex gap-6 mt-4 text-sm text-white/70",children:[s.jsxs("span",{children:["Started: ",R(D.startedAt)]}),s.jsxs("span",{children:["Ended: ",R(D.endedAt)]}),s.jsxs("span",{children:["User: ",D.userName||"Guest"]})]})]}),s.jsx("div",{className:"p-4 overflow-y-auto max-h-[50vh] space-y-4 bg-dark-50 dark:bg-dark-900",children:null==(f=D.messages)?void 0:f.map((e,a)=>{var t;return s.jsx("div",{children:"system"===e.type?s.jsx("div",{className:"flex justify-center",children:s.jsx("span",{className:"px-4 py-1.5 bg-dark-200 dark:bg-dark-700 text-dark-500 text-xs rounded-full",children:e.content})}):"user"===e.type?s.jsx("div",{className:"flex justify-end",children:s.jsxs("div",{className:"max-w-[80%]",children:[s.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2.5 rounded-2xl rounded-br-md",children:s.jsx("p",{className:"text-sm",children:e.content})}),s.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1",children:[s.jsx("span",{className:"text-xs text-dark-400",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),"read"===e.status&&s.jsx(v,{className:"w-3 h-3 text-blue-500"})]})]})}):s.jsxs("div",{className:"flex items-end gap-2",children:[(null==(t=D.agent)?void 0:t.avatar)&&s.jsx("img",{src:D.agent.avatar,alt:"",className:"w-8 h-8 rounded-full"}),s.jsxs("div",{className:"max-w-[80%]",children:[s.jsx("div",{className:"bg-white dark:bg-dark-800 px-4 py-2.5 rounded-2xl rounded-bl-md shadow-sm border border-dark-100 dark:border-dark-700",children:s.jsx("p",{className:"text-sm text-dark-800 dark:text-dark-200",children:e.content})}),s.jsx("span",{className:"text-xs text-dark-400 mt-1 block",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},a)})})]})})}),s.jsx(p,{children:T&&s.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>U(!1),children:s.jsx(x.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-dark-800 rounded-2xl shadow-2xl max-w-md w-full p-6",onClick:e=>e.stopPropagation(),children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(d,{className:"w-8 h-8 text-red-500"})}),s.jsx("h3",{className:"text-xl font-bold mb-2",children:"Delete All Chats?"}),s.jsxs("p",{className:"text-dark-500 mb-6",children:["This will permanently delete ",w.length," chat",1!==w.length?"s":"",". This action cannot be undone."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>U(!1),className:"flex-1 btn-outline",children:"Cancel"}),s.jsx("button",{onClick:()=>{y(),U(!1),t.success("All chats deleted")},className:"flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-xl font-medium transition-colors",children:"Delete All"})]})]})})})})]})}export{N as default};
